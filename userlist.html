<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>User List</title>
    <link rel="stylesheet" href="assets/style.css" />
  </head>
  <body>
    <main>
      <h1>User List</h1>
      <ul id="users" class="user__list unstyled-list"></ul>
      <nav
        role="navigation"
        aria-label="pagination"
        class="pagination"
        id="pagination"
      ></nav>
    </main>
    <footer class="site__footer"><a href="/logout.html">Log Out</a></footer>
    <script>
      const users = [
        {
          student_id: 1,
          student_fname: 'name1',
          student_lname: 'lname1',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 2,
          student_fname: 'name2',
          student_lname: 'lname2',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 3,
          student_fname: 'name3',
          student_lname: 'lname3',
          student_active: false,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 4,
          student_fname: 'name4',
          student_lname: 'lname4',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 5,
          student_fname: 'name5',
          student_lname: 'lname5',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 6,
          student_fname: 'name6',
          student_lname: 'lname6',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 7,
          student_fname: 'name7',
          student_lname: 'lname7',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 8,
          student_fname: 'name8',
          student_lname: 'lname8',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 9,
          student_fname: 'name9',
          student_lname: 'lname9',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 10,
          student_fname: 'name10',
          student_lname: 'lname10',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 11,
          student_fname: 'name11',
          student_lname: 'lname11',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 12,
          student_fname: 'name12',
          student_lname: 'lname12',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 13,
          student_fname: 'name13',
          student_lname: 'lname13',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 14,
          student_fname: 'name14',
          student_lname: 'lname14',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        },
        {
          student_id: 15,
          student_fname: 'name15',
          student_lname: 'lname15',
          student_active: true,
          groups: ['category1', 'category2', 'category3']
        }
      ];

      const fetchUsers = async () => {
        try {
          const response = await fetch('/knowledgecity/api/student/read.php');
          if (!response.ok) {
            throw new Error(response.status);
          }
          // const data = await response.json();
          const data = await response;
          console.log(data);
        } catch (error) {
          console.log(error);
        }
      };
      fetchUsers();

      // function traer() {
      //   fetch('/api/student/read.php')
      //     .then(res => res.json())
      //     .then(datos => {
      //       // console.log(datos)
      //       tabla(datos);
      //     });
      // }

      createListItem = user => {
        return `<li class='user'>
            <i class='user__active icon ${
              user.student_active ? 'active' : ''
            }'></i>
            <p class='user__id'>${user.student_id}</p>
            <p class='user__name'>${user.student_fname} ${
          user.student_lname
        }</p>
            <ul class='user__group-list inline-list'>
              <li>category1</li>
              <li>category2</li>
              <li>category3</li>
            </ul>
          </li>`;
      };

      const list_element = document.querySelector('#users');
      const pagination_element = document.querySelector('#pagination');

      let current_page = 1;
      let rows = 5;

      setupPagination = (items, wrapper, rows_per_page) => {
        wrapper.innerHTML = '';

        let page_count = Math.ceil(items.length / rows_per_page);
        for (let i = 1; i < page_count + 1; i++) {
          let btn = paginationButton(i, items);
          wrapper.appendChild(btn);
        }
      };

      paginationButton = (page, items) => {
        let button = document.createElement('button');
        button.classList.add('pagination__item');
        button.innerHTML = `<span class="visuallyhidden">page </span>${page}`;

        if (current_page == page) button.classList.add('active');

        button.addEventListener('click', function() {
          current_page = page;
          populateList(items, list_element, rows, current_page);

          let current_btn = document.querySelector('.pagination button.active');
          current_btn.classList.remove('active');

          button.classList.add('active');
        });

        return button;
      };

      populateList = (items, wrapper, rows_per_page, page) => {
        wrapper.innerHTML = '';
        page--;

        let start = rows_per_page * page;
        let end = start + rows_per_page;
        let paginatedItems = items.slice(start, end);

        for (let i = 0; i < paginatedItems.length; i++) {
          let item = paginatedItems[i];

          let item_element = createListItem(item);

          wrapper.innerHTML += item_element;
        }
      };

      populateList(users, list_element, rows, current_page);
      setupPagination(users, pagination_element, rows);
    </script>
  </body>
</html>
